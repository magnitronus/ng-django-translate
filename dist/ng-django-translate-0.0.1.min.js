var module=angular.module("ngDjangoTranslate",["ngDjangoTranslate.directives","templates-ngDjangoTranslate"]);module.provider("ngDjangoTranslate",function(){var settings=this.settings={urls:{languages:"/languages/",catalog:"/catalog/"},default_lang:"en"};this.config=function(newSettings){angular.extend(settings,newSettings)},this.$get=["$q","$http","$rootScope",function($q,$http,$rootScope){var thisModule=this;thisModule.loaded=!1;var privateMethods={init:function(){var defferer=$q.defer();return $http.get(thisModule.settings.urls.languages).then(function(resp){var data=resp.data;thisModule.languages=data.languages,thisModule.current_language=data.current,privateMethods.catalog_reload().then(function(){thisModule.loaded=!0,thisModule.loader=null,thisModule.languages[thisModule.current_language].code!=thisModule.settings.default_lang&&$rootScope.$broadcast("ngDjangoTranslate.language.changed"),defferer.resolve()})}),defferer.promise},catalog_reload:function(){return catalog_param={lang:thisModule.languages[thisModule.current_language].code},$http.get(thisModule.settings.urls.catalog,{params:catalog_param}).then(function(resp){thisModule.catalog=resp.data})}},publicMethods={is_ready:function(){return thisModule.loaded?!0:!1},get_loader:function(){return thisModule.loader},get_languages:function(){return thisModule.languages},get_current_language:function(){return thisModule.languages[thisModule.current_language]},get_catalog:function(){return thisModule.catalog},set_language:function(language_code){var defferer=$q.defer();return $http.post(thisModule.settings.urls.languages,{lang:language_code}).then(function(resp){var data=resp.data,i=0,catalog_onreload=function(){$rootScope.$broadcast("ngDjangoTranslate.language.changed"),defferer.resolve()};if(data.success)for(;i<thisModule.languages.length;)thisModule.languages[i].code==language_code&&(thisModule.current_language=i,privateMethods.catalog_reload().then(catalog_onreload)),i++}),defferer.promise},settings:thisModule.settings};return thisModule.loader=privateMethods.init(),publicMethods}]});var directives=angular.module("ngDjangoTranslate.directives",[]).directive("langSelector",["$document","$rootScope","ngDjangoTranslate",function($document,$rootScope,ngDjangoTranslate){return{restrict:"AE",transclude:!0,templateUrl:function(){return ngDjangoTranslate.settings.selector_template||"langselector.html"},scope:{},link:function(scope){var dd_id_generate=function(){function _p8(s){var p=(Math.random().toString(16)+"000000000").substr(2,8);return s?"-"+p.substr(0,4)+"-"+p.substr(4,4):p}return _p8()+_p8(!0)+_p8(!0)+_p8()};scope.show_dd=!1,scope.dd_id="DD-"+dd_id_generate();var set_languages=function(){scope.languages=ngDjangoTranslate.get_languages(),scope.current_language=ngDjangoTranslate.get_current_language()};ngDjangoTranslate.is_ready()?set_languages():ngDjangoTranslate.get_loader().then(set_languages),scope.show_dropdown=function(){scope.show_dd=!scope.show_dd,scope.show_dd?$document.bind("click",scope.clickOutsideHandler):$document.unbind("click",scope.clickOutsideHandler)},scope.lngFilterFn=function(language){return language!==scope.languages[scope.current_language]},scope.set_language=function(code){scope.show_dd=!1,ngDjangoTranslate.set_language(code).then(function(data){scope.current_language=data})},scope.clickOutsideHandler=function(e){var element;if(e.target){for(element=e.target;element;element=element.parentNode){var id=element.id;if(element.className,angular.isDefined(id)&&id==scope.dd_id)return}scope.show_dd&&(scope.show_dropdown(),scope.$apply())}}}}}]).directive("djTranslatable",["ngDjangoTranslate","$rootScope",function(ngDjangoTranslate,$rootScope){return{restrict:"A",scope:{djTranslatable:"@"},link:function(scope,elem,attrs){if(scope.msg_ids={},angular.isDefined(scope.djTranslatable)){var attr_names=scope.djTranslatable.split(",");angular.forEach(attr_names,function(attr_name){scope.msg_ids[attr_name]=attrs[attr_name]})}elem.text()&&(scope.msg_ids.innerText=elem.html());var do_translate=function(){var tr_catalog=ngDjangoTranslate.get_catalog(),curr_lang=ngDjangoTranslate.get_current_language(),def_lang_code=ngDjangoTranslate.settings.default_lang;angular.forEach(scope.msg_ids,function(value,key){curr_lang.code==def_lang_code?"innerText"==key?elem.html(value):elem.attr(key,value):angular.isDefined(tr_catalog[value])&&("innerText"==key?elem.text(tr_catalog[value]):elem.attr(key,tr_catalog[value]))})};$rootScope.$on("ngDjangoTranslate.language.changed",do_translate)}}}]);angular.module("templates-ngDjangoTranslate",["langselector.html"]),angular.module("langselector.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("langselector.html",'<ul class="language_select">\n    <li class="current-language">\n        <a class="popup-button" ng-click="show_dropdown()">{$languages[current_language][\'code\'] | uppercase$}</a>\n        <ul id="{$dd_id$}" class="popup-menu" ng-show="show_dd">\n            <li class="language-var" ng-repeat="language in languages | filter:lngFilterFn | orderBy:\'code\'">\n\n                <a title="Change to language: {$language.name$}" class="language-link" ng-click="set_language(language.code);">\n                    <span class="flag-16" ng-class="\'flag-16-\'+language.code"></span> {$language.name$}</a>\n            </li>\n        </ul>\n    </li>\n</ul>')}]);